<html>
<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>

<svg id="chord" height="850" width="850" style="background: #fff; margin-top:50px" >
    </svg>

<svg id="spider" height="600" width="600"></svg>
<div id="send-bar"></div>
<div id="receive-bar"></div>

<script>

let data = [];
//  let Dict = { 'China': 
//  { '1990':1,'1995':1,'2000':1 },
//           'Japan': { '1990':{},'1995':{},'2000':{}}}
const features = ["health","climate","civil liberty"];
const country_names = ['China','Japan','South Korea','North Korea','Taiwan','Mongolia',"United States",'Canada']





country_data = {
'China': {'health': 3.363636363636363, 'climate': 0.7257151269449413, 'civil liberty': 4},
'Japan': {'health': 9.772727272727273, 'climate': 3.918873009761511, 'civil liberty': 8},
'South Korea': {'health': 8.136363636363637, 'climate': 4.033474509093379, 'civil liberty': 8},
'North Korea': {'health': 0.13636363636363508, 'climate': 0.0, 'civil liberty': 3}, 
'Taiwan': {'health': 7.0, 'climate': 4.87011075125133, 'civil liberty': 9}, 
'Mongolia': {'health': 0.0, 'climate': 0.1468756369895592, 'civil liberty': 8}, 
'United States': {'health': 9.113636363636362, 'climate': 10.0, 'civil liberty': 9},
'Canada': {'health': 10.0, 'climate': 8.362568794872375, 'civil liberty': 9} }
console.log(country_data)


// for (var i = 0; i < 3; i++ ){
//         var point = {}

//         features.forEach(f => point[f] = 1 + Math.random() * 8);
//         data.push(point);
//     }
//     console.log(data);




// for  (var i = 0; i < 5; i++){
//     data[i]["Country"] = "China";
// }

// for (var i = 5; i < 9; i++){
//     data[i]["Country"] = "United States";
// }

// console.log(data)


allKeys = Object.keys(country_data);
console.log("allkeys", allKeys);


                    
const svg = d3.select("svg#spider");
const width = svg.attr("width");
const height = svg.attr("height");


let spiderChart = svg.append("g").attr("id","diagrams");
let annotations = svg.append("g").attr("id","annotations");

let radialScale = d3.scaleLinear()
    .domain([0,10])
    .range([0,250]);
let ticks = [2,4,6,8,10];


ticks.forEach(t =>
    annotations.append("circle")
    .attr("cx", 300)
    .attr("cy", 300)
    .attr("fill", "none")
    .attr("stroke", "gray")
    .attr("r", radialScale(t))
);

function angleToCoordinate(angle, value){
    let x = Math.cos(angle) * radialScale(value);
    let y = Math.sin(angle) * radialScale(value);
    return {"x": 300 + x, "y": 300 - y};
}

for (var i = 0; i < features.length; i++) {
    console.log(i);
    let ft_name = features[i];
    let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
    let line_coordinate = angleToCoordinate(angle, 10);
    let label_coordinate = angleToCoordinate(angle, 10.5);
    console.log(line_coordinate);

    //draw axis line
    annotations.append("line")
    .attr("x1", 300)
    .attr("y1", 300)
    .attr("x2", line_coordinate.x)
    .attr("y2", line_coordinate.y)
    .attr("stroke","black");

    //draw axis label
    annotations.append("text")
    .attr("x", label_coordinate.x)
    .attr("y", label_coordinate.y)
    .text(ft_name);
}

allKeys.forEach( d => {

d3.select("div#send-bar")
  .append("button")
  .text(d)
  .on('click', function(){
    updateSend(d);

  })


  d3.select("div#receive-bar")
  .append("button")
  .text(d)
  .on('click', function(){
    updateReceive(d);

  })


});

tri_send = spiderChart.append("path")
                 .attr("stroke-width", 3)
                 .attr("stroke-opacity", 1)
                 .attr("opacity", 0.5);

tri_receive = spiderChart.append("path")
                 .attr("stroke-width", 3)
                 .attr("stroke-opacity", 1)
                 .attr("opacity", 0.5);



let colorScale = d3.scaleOrdinal()
                    .domain(country_names)
                    .range(["tomato", "slateblue", "navy","rosybrown","skyblue","sandybrown","plum"])






function updateSend (countryKey) {
    const data = country_data[countryKey];

        console.log("data",data)
    


let line = d3.line()
    .x(d => d.x)
    .y(d => d.y);


function getPathCoordinates(data_point){
let coordinates = [];
    for (var i = 0; i < features.length; i++){
        let ft_name = features[i];
    
        let angle = (Math.PI /2) + (2 * Math.PI * i / features.length);
        coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
    }
    return coordinates;
}



    let d = data;
    console.log("d",d);
    
    let color = 'gray';
    let coordinates = getPathCoordinates(d);
    console.log("coordinates", coordinates);
    


    //draw the path element
    tri_send.datum(coordinates)  
        .transition()
        .attr("d", line) 
        .attr("stroke", d => colorScale(d))
        .attr("fill", d => colorScale(d))            
  

}



function updateReceive (countryKey) {
    const data = country_data[countryKey];

        console.log("data",data)
    


let line = d3.line()
    .x(d => d.x)
    .y(d => d.y);


function getPathCoordinates(data_point){
let coordinates = [];
    for (var i = 0; i < features.length; i++){
        let ft_name = features[i];
    
        let angle = (Math.PI /2) + (2 * Math.PI * i / features.length);
        coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
    }
    return coordinates;
}



    let d = data;
    console.log("d",d);
    
    let color = 'gray';
    let coordinates = getPathCoordinates(d);
    console.log("coordinates", coordinates);
    


    //draw the path element
    tri_receive.datum(coordinates)  
        .transition()
        .attr("d", line) 
        .attr("stroke", d => colorScale(d))
        .attr("fill", d => colorScale(d))            
  

}





</script>
 
</body>
</html>