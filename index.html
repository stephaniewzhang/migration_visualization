<html>
    <head>
        <title>Visualization</title>

        <link rel="stylesheet" type="text/css" href="../css/styles.css">
        <script src="https://d3js.org/d3.v7.min.js"></script>
    </head>
    <body>
        <!-- First Visualization: Chord Diagram -->
        <!--<h1>Chord Graph Example</h1> -->
        <div class = "banner" height = "100%"  width ="100%">
            <h1 class = "title ">MIGRATION VISUALIZATION </h1>
            <h1 class = "title "> Migration Visualization</h1>
            <h1 class = "title "></h1>
        </div>
        <svg id="chord" height="900" width="900" ></svg>

    <style> 

    body {
        background-color: rgb(234, 230, 222);
        text-align: center;
   
    }

    .title {
        color: rgb(44, 69, 97);
        stroke-width: 3;
        font-size: 60;
        font-family: 'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        font-style: oblique;
    }

    .banner {
        margin-top: 15%;
        margin-bottom: 10%;
    }

    .sub-title {
        font-family:'Lucida Sans', 'Lucida Sans Regular', 'Lucida Grande', 'Lucida Sans Unicode', Geneva, Verdana, sans-serif;
        color: rgb(44, 69, 97)
        }
    
    .column {
        flex-direction: column;
        display: flex;
    }
    
    .button {
    
        color: rgb(252, 252, 252);
        border: 2px ;
        border-radius: 8px;
        width: 100;
        height: 40;
        cursor: pointer;
}

    .chord-label {
        font-size: 10;
    }
        
    


    </style>


        <script>
            const width = d3.select("#chord").attr("width");
            const height = d3.select("#chord").attr("height");
            const chordChart = d3.select("#chord").append("g");
            
            const drawChord = async () => {
            const colorPalette = ["#48bf8e", "#075c62", "#a1def0", "#5e2a96", 
                                    "#e775cc", "#f3c5fa", "#9a76af", "#1c4585", 
                                    "#479abc", "#94ea5b", "#1d6d1f", "#cddb9b", 
                                    "#604020", "#d48f4d", "#f24219", "#8e1023", 
                                    "#8c956d", "#2cf52b", "#ff0087", "#e9d737"]
          
              const edges_ds = await d3.json("edges.json");
              const nodes_ds = await d3.json("nodes.json");

              let links = edges_ds;
              let nodes = nodes_ds;
              console.log("links",links);
              console.log("nodes",nodes);
            }
            drawChord();
        </script>

        <!-- Second Visualization: Spider Diagram -->
       <!---<h1>Spider Diagram</h1> -->
        <p id = 'spider-chart'>
        <div class = "column">
            <div id="send-bar">
                <h3 class = 'sub-title'>Sending Country:</h3>
            </div>
            <div id="receive-bar">
                <h3 class = 'sub-title'>Receiving Country:</h3>
            </div>
        
        </div>
            <svg id="spider" height="800" width="800"></svg>

            
            <script>
            
            const features = ["Health","CO2 Emission","Civil Liberty"];
            const country_names = ['China','Japan','South Korea','North Korea','Taiwan','Mongolia',"United States",'Canada']
            const country_colors = ['#5E1240','#3A394E','#E16425','#033148','#0D6D76','#C88477','#E6484B','#9292C2']


            let spider_colorScale = d3.scaleOrdinal()
                                .domain([country_names])
                                .range(country_colors);


            
            country_data = {
            'China': {'Health': 6.2, 'CO2 Emission': 0.7257151269449413, 'Civil Liberty': 4},
            'Japan': {'Health': 9.02, 'CO2 Emission': 3.918873009761511, 'Civil Liberty': 8},
            'South Korea': {'Health': 8.3, 'CO2 Emission': 4.033474509093379, 'Civil Liberty': 8},
            'North Korea': {'Health': 4.78, 'CO2 Emission': 0.0, 'Civil Liberty': 3}, 
            'Taiwan': {'Health': 7.8, 'CO2 Emission': 4.87011075125133, 'Civil Liberty': 9}, 
            'Mongolia': {'Health': 4.72, 'CO2 Emission': 0.1468756369895592, 'Civil Liberty': 8}, 
            'United States': {'Health': 8.73, 'CO2 Emission': 10.0, 'Civil Liberty': 9},
            'Canada': {'Health': 9.12, 'CO2 Emission': 8.362568794872375, 'Civil Liberty': 9} }
            console.log(country_data)
            
            allKeys = Object.keys(country_data);
            console.log("allkeys", allKeys);
                            
            const svg = d3.select("svg#spider");
            const spider_width = svg.attr("width");
            const spider_height = svg.attr("height");
            
            let spiderChart = svg.append("g").attr("id","diagrams");
            let annotations = svg.append("g").attr("id","annotations");
            
            let radialScale = d3.scaleLinear()
                .domain([0,10])
                .range([0,250]);
            let ticks = [2,4,6,8,10];
            
            // ticks.forEach(t =>
            //     annotations.append("circle")
            //     .attr("cx", 300)
            //     .attr("cy", 300)
            //     .attr("fill", "none")
            //     .attr("stroke", "lightgray")
            //     .attr("r", radialScale(t))
            // );
            
            function angleToCoordinate(angle, value){
                let x = Math.cos(angle) * radialScale(value);
                let y = Math.sin(angle) * radialScale(value);
                return {"x": 400 + x, "y": 400 - y};
            }
            
            for (var i = 0; i < features.length; i++) {
                console.log(i);
                let ft_name = features[i];
                let angle = (Math.PI / 2) + (2 * Math.PI * i / features.length);
                let line_coordinate = angleToCoordinate(angle, 10);
                let label_coordinate = angleToCoordinate(angle, 11.5);
                console.log(line_coordinate);
            
                //draw axis line
                annotations.append("line")
                .attr("x1", 400)
                .attr("y1", 400)
                .attr("x2", line_coordinate.x)
                .attr("y2", line_coordinate.y)
                .attr("stroke","lightgray");
            
                //draw axis label
                annotations.append("text")
                .attr("x", label_coordinate.x)
                .attr("y", label_coordinate.y)
                .text(ft_name)
                .attr("stroke","gray")
                .attr("fill","gray");

            }
            
            allKeys.forEach( d => {
            
            d3.select("div#send-bar")
              .append("button")
              .text(d)
              .style ("display" , "inline-block")
              .style("margin","4")
              .style ("background-color",spider_colorScale(d))
              .attr("class", "button")

            
              .on('click', function(){
                updateSend(d); 
            
              }) 
            
            
              d3.select("div#receive-bar")
              .append("button")
              .text(d)
              .style("margin","4")
              .style ("background-color",spider_colorScale(d))
              .attr("class", "button")
              .on('click', function(){
                updateReceive(d);
            
              })
            
            
            });
            
            tri_send = spiderChart.append("path")
                             .attr("stroke-width", 3)
                             .attr("stroke-opacity", 1)
                             .attr("opacity", 0.7);
            
            tri_receive = spiderChart.append("path")
                             .attr("stroke-width", 3)
                             .attr("stroke-opacity", 1)
                             .attr("opacity", 0.7);
            
            
            


            console.log("spider_colorScale", spider_colorScale);            
            
            
            function updateSend (countryKey) {
                const data = country_data[countryKey];
            
                    console.log("data",data)
                
            
            let line = d3.line()
                .x(d => d.x)
                .y(d => d.y);
            
            
            function getPathCoordinates(data_point){
            let coordinates = [];
                for (var i = 0; i < features.length; i++){
                    let ft_name = features[i];
                
                    let angle = (Math.PI /2) + (2 * Math.PI * i / features.length);
                    coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
                }
                return coordinates;
            }
            
                let d = data;
                console.log("d",d);
                
                
                let coordinates = getPathCoordinates(d);
                console.log("coordinates", coordinates);
                
                //draw the path element
                tri_send.datum(coordinates)  
                    .transition()
                    .attr("d", line) 
                    .attr("stroke", spider_colorScale(countryKey))
                    .attr("fill", spider_colorScale(countryKey))            
            }





            
            function updateReceive (countryKey) {
                const data = country_data[countryKey];
            
                    console.log("data",data)
        
            let line = d3.line()
                .x(d => d.x)
                .y(d => d.y);
            
            function getPathCoordinates(data_point){
            let coordinates = [];
                for (var i = 0; i < features.length; i++){
                    let ft_name = features[i];
                
                    let angle = (Math.PI /2) + (2 * Math.PI * i / features.length);
                    coordinates.push(angleToCoordinate(angle, data_point[ft_name]));
                }
                return coordinates;
            }
            
                let d = data;
                console.log("d",d);
                
                
                let coordinates = getPathCoordinates(d);
                console.log("coordinates", coordinates);
                
            
            
                //draw the path element
                tri_receive.datum(coordinates)  
                    .transition()
                    .attr("d", line) 
                    .attr("stroke", spider_colorScale(countryKey))
                    .attr("fill", spider_colorScale(countryKey))            
              
            
            }
            </script>
        </p>
    </body>
</html>